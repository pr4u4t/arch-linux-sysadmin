#!/bin/bash

function scriptDir
{
        SOURCE="${BASH_SOURCE[0]}"

        while [ -h "$SOURCE" ]; do # resolve $SOURCE until the file is no longer a symlink
                DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
                SOURCE="$(readlink "$SOURCE")"
                [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE" # if $SOURCE was a relative symlink, we need to resolve it relative to the path where the symlink file was located
        done
        DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
        echo $DIR
}


sdir=`scriptDir`

#chown sysadmin:sysadmin -R "${sdir}/.."
chown prauat:prauat -R "${sdir}/.."

files=$( (stat -c"%A %n" `find "${sdir}/.." -type d | grep -Ev -e "/\.[A-Za-z0-9_-]+"` ) && ( stat -c"%A %n" `find "${sdir}/.." -type f | grep -Ev -e "/\.[A-Za-z0-9_-]+"`) )

scripts=`echo "${files}" | grep -E -e "^[-][r-][w-][x]" | awk 'BEGIN { FS=" " } ; { print $2 }'`
echo -e "scripts:\r\n${scripts}"
chmod 0770 `echo -e "${scripts}"`

directories=`echo -e "${files}" | grep -E -e "^d" | awk 'BEGIN { FS=" " } ; { print $2 }' | grep -Ev -e "^${sdir}$"`
echo -e "directories:\r\n${directories}"
chmod 0770 `echo -e "${directories}"`

configuration=`echo -e "${files}" | grep -E -e "(conf)|([A-Za-z]+\.service)|(rc$)" | awk 'BEGIN { FS=" " } ; { print $2 }'`
echo -e "configurations:\r\n${configuration}"
chmod 0660 `echo -e ${configuration}`
